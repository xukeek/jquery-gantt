/*!
   * Gantt v1.0.0
   * https://github.com/oguzhanoya/jquery-gantt
   *
   * Copyright (c) 2017 oguzhanoya
   * Released under the MIT license
   */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(t.$)}(this,function(t){"use strict";t="default"in t?t.default:t;var e={data:[],dataURL:"",startDate:new Date,endDate:new Date,cellWidth:20,cellHeight:38,language:"en",stickyHeader:!1,mouseScroll:!1,mouseScrollpx:120,lazyLoad:!1,autoHide:!1,onInit:$.noop,onDestroy:$.noop},a={buildData:function(){var e=this.config.dataURL;return t.ajax({url:e,dataType:"jsonp",jsonp:"callback",crossDomain:!0,contentType:"application/json"})},initLazyLoad:function(){var t=this.config.startDate,e=this.config.endDate;t.setHours(0,0,0,0),e.setHours(0,0,0,0),this.scrollHandler()},renderLazyLoad:function(e,a,n){this.renderLazyLoadGrid(e,a,n);var i=t(this.element),s=t(".gantt-header-months",i),o=t(".gantt-header-days",i),r=t(".gantt-header-days-min",i),d=this.dateDiffInDays(a,n);this.renderLazyLoadEvents(e,d);for(var l=0;l<=d;l+=1){var h=t("<div>",{class:"gantt-header-month"}),c=t("<div>",{class:"gantt-header-day"}),g=t("<div>",{class:"gantt-header-day-min"}),f=a.getDate(),u=a.getMonth()+1,v=a.getFullYear(),p=this.daysInMonth(u,v)*this.config.cellWidth,y=this.config.region.monthNames[u-1],D=t(c).text(f).css("width",this.config.cellWidth),m=t(h).text(y+" "+v).css({width:p});o.append(D),r.append(g);var w=0===l,L=this.firstDayMonth(v,u);L.setHours(0,0,0,0);var T=this.firstDayMonth(this.config.endDate.getFullYear(),this.config.endDate.getMonth()+1);T.setHours(0,0,0,0);var H=this.isEqual(a,L),W=this.isEqual(a,T);(H||w)&&(w&&(p-=(f-1)*this.config.cellWidth),W&&(p=this.config.endDate.getDate()*this.config.cellWidth),s.append(m)),a.setDate(a.getDate()+1)}var k=t(".gantt-header-day",i).length*this.config.cellWidth;t(s,i).css({width:k}),t(o,i).css({width:k}),t(r,i).css({width:k});var M=t(".gantt-grid",i);t(M,i).css({width:k});var b=t(".gantt-grid-row",i);t(b,i).css({width:this.gridDefaults.gridtotalWidth});var x=t(".gantt-grid-col",i);t(x,i).css({height:this.gridDefaults.gridtotalHeight}),t(".gantt-event-row",i).css({width:this.gridDefaults.gridtotalWidth}),this.gridDefaults.eventsWidth=this.gridDefaults.gridtotalWidth},renderLazyLoadGrid:function(e,a,n){for(var i=t(this.element),s=this.dateDiffInDays(a,n),o=this.getTotalWidth(s),r=this.getTotalHeight(e.length),d=t(".gantt-grid",i),l=t(".gantt-grid-cols",i),h=t(".gantt-grid-rows",i),c=new Date(a.getTime()),g=0;g<=s;g+=1){var f=t("<div>",{class:"gantt-grid-col",width:this.config.cellWidth,height:r});f.css("width",this.config.cellWidth);var u=c.getMonth()+1,v=c.getFullYear(),p=this.lastDayMonth(v,u);this.isEqual(c,p)&&f.css("border-color","#bec5cc"),l.append(f),c.setDate(c.getDate()+1)}e.forEach(function(){var e=t("<div>",{class:"gantt-grid-row",width:o,height:this.config.cellHeight});h.append(e)},this),d.append(l).append(h),this.gridDefaults.gridtotalWidth+=o,this.gridDefaults.gridtotalHeight+=r},renderLazyLoadContainer:function(){var e=t("<div>",{class:"gantt-container"}),a=t("<div>",{class:"gantt-wrapper"}),n=t("<div>",{class:"gantt-header"}),i=t("<div>",{class:"gantt-header-months"}),s=t("<div>",{class:"gantt-header-days"}),o=t("<div>",{class:"gantt-header-days-min"}),r=t("<div>",{class:"gantt-grid"}),d=t("<div>",{class:"gantt-events"}),l=t("<div>",{class:"gantt-loading",style:"display: none"});n.append(t(i)),n.append(t(s)),n.append(t(o));var h=t("<div>",{class:"gantt-grid-cols"}),c=t("<div>",{class:"gantt-grid-rows"});return r.append(h).append(c),e.append(n).append(r).append(d),a.append('<div class="arrow arrow-left"><span class="arrow-icon"></span></div>').append(e).append('<div class="arrow arrow-right"><span class="arrow-icon"></span></div>').append(l),a},renderLazyLoadEvents:function(e){var a=t(this.element),n=t(".gantt-events",a);return e.forEach(function(e){var a=t("<div>",{class:"gantt-event-row",width:this.totalWidth});e.forEach(function(e){var n=new Date(e.startdate),i=t("<div>",{class:"gantt-event"}),s=(parseInt(e.minNight,10)+1)*this.config.cellWidth,o=this.dateDiffInDays(this.config.startDate,n),r=t.extend(e.tooltipData,{price:e.price}),d="";d="Tur"===e.type?"tourFly":"TurBus"===e.type?"tourBus":"cruise";var l=""+e.title,h=t("<a>",{class:this.format("gantt-event-block {0}",d),width:s+"px",href:"/"+e.url,target:"_blank"}).text(l).css("line-height",this.config.cellHeight-28+"px").data("tooltip",this.tooltipView(r)),c=o*this.config.cellWidth+this.gridDefaults.eventsWidth;a.append(i.css("left",c).append(h)).css("height",this.config.cellHeight)},this),n.append(a)},this),n}},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),s=function(){function a(i,s){n(this,a);var o={gridtotalHeight:0,gridtotalWidth:0,eventsWidth:0},r=s.language||e.language;s.lang=a.LANGUAGES[r],this.config=t.extend({},e,s),this.gridDefaults=t.extend({},o),this.element=i,""===this.config.dataURL&&this.config.data.length<=0?console.warn("jquery-gantt: must provide a data source"):""===this.config.dataURL&&this.config.lazyLoad?console.warn("jquery-gantt: dataURL is required for lazyLoad"):this.init()}return i(a,[{key:"init",value:function(){var e=this;this.hook("onInit");var a="";t(this.element).html(a),this.config.endDate.getTime()>this.config.startDate.getTime()?(this.config.lazyLoad?(this.initLazyLoad(),a=this.renderLazyLoadContainer()):this.config.data.length<=0&&""!==this.config.dataURL?this.buildData().then(function(n){e.config.data=n.Items,a=e.renderContainer(),t(e.element).html(a),e.attachEvents(e.element,e.config),e.tooltipHover(),e.colHighlighter()}):a=this.renderContainer(),(this.config.data.length>0||this.config.lazyLoad)&&(t(this.element).html(a),this.attachEvents(this.element,this.config),this.tooltipHover(),this.colHighlighter())):console.warn("jquery-gantt: start-date is not greater than end-date")}},{key:"hook",value:function(t){void 0!==this.config[t]&&this.config[t].call(this.el)}},{key:"attachEvents",value:function(e,a){if(a.stickyHeader){var n=function(){var a=t(".gantt-wrapper",e).offset().top,n=t(".gantt-wrapper",e).height();a>=t(this).scrollTop()||t(this).scrollTop()>=a+n-80?(t(".gantt-header",e).css("position","static"),t(".arrow",e).css("position","static")):(t(".arrow",e).css({position:"relative",top:t(this).scrollTop()-a+"px"}),t(".gantt-header",e).css({position:"relative",top:t(this).scrollTop()-a+"px",left:t(this).scrollLeft+"px","z-index":1}))};t(window).scroll(n)}if(a.mouseScroll&&t(".gantt-container",e).on("wheel mousewheel",function(t){t.originalEvent.wheelDelta>0||t.originalEvent.detail<0?this.scrollLeft-=a.mouseScrollpx:this.scrollLeft+=a.mouseScrollpx}),a.lazyLoad){var i=this,s=!1;t(".gantt-container",e).scroll(function(){this.scrollWidth-this.clientWidth-this.scrollLeft<900&&!s&&(s=!0,i.scrollHandler(function(){s=!1}))})}t(".gantt-container",e).on("mousedown",function(e){return t(this).data("down",!0).data("x",e.clientX).data("scrollLeft",this.scrollLeft).addClass("dragging"),!1}).on("mouseup",function(){t(this).data("down",!1).removeClass("dragging")}).on("mousemove",function(n){if(!0===t(this).data("down")&&(this.scrollLeft=t(this).data("scrollLeft")+t(this).data("x")-n.clientX),a.autoHide){var i=this.scrollLeft,s=i/a.cellWidth;s=Math.floor(s);var o=s*a.cellWidth,r=t(".gantt-events",e).find(".gantt-event");t.each(r,function(e,a){var n=t(a).css("left");n=parseInt(n,10),n<=o?t(a).closest(".gantt-event-row").hide():t(a).closest(".gantt-event-row").show()});var d=new Date(a.startDate.getTime());d.setDate(d.getDate()+s)}}).on("mouseleave",function(){t(this).data("down",!1).removeClass("dragging")}),t(".arrow",e).on("click",function(){var a=t(this).hasClass("arrow-right"),n=t(".gantt-container",e).scrollLeft();a?t(".gantt-container",e).scrollLeft(n+240):t(".gantt-container",e).scrollLeft(n-240)})}},{key:"xhrRequest",value:function(e,a){var n=this,i=t(this.element),s=this.config.dataURL;return t.ajax({url:s,dataType:"jsonp",jsonp:"callback",contentType:"application/json",crossDomain:!0,data:{startDate:n.getFormattedDate(e),endDate:n.getFormattedDate(a)},beforeSend:function(){t(".gantt-loading",i).fadeIn()}})}},{key:"scrollHandler",value:function(e){var a=this,n=t(this.element),i=this.config.startDate,s=new Date(this.config.startDate.getTime());s.setMonth(s.getMonth()+2);var o=s.getMonth()+1,r=s.getFullYear();s=this.lastDayMonth(r,o);var d=this.config.endDate.getMonth()+1,l=this.config.endDate.getFullYear(),h=this.config.endDate.getDate();(r===l||r>l)&&(r>l&&(s.setMonth(d-1),s.setYear(l),s.setDate(h)),(o===d||o>d)&&(s.setMonth(d-1),s.setDate(h))),i.getTime()<=this.config.endDate.getTime()&&this.xhrRequest(i,s).done(function(t){a.renderLazyLoad(t.Items,i,s),a.tooltipHover(),a.colHighlighter(),"function"==typeof e&&e()}).always(function(){t(".gantt-loading",n).fadeOut()})}},{key:"isTimeInRange",value:function(t,e,a){var n=this.config.ranges,i="{0}";i+=e>=10?"-{1}":"-0{1}",i+=a>=10?"-{2}":"-0{2}";for(var s=new Date(this.format(i,t,e,a)),o=0;o<n.length;o+=1){var r=n[o][0],d=n[o][1];if(s>=new Date(r)&&s<=new Date(d))return console.info(this.format("{0}-{1}-{2}",t,e,a)),!0}return!1}},{key:"renderHeader",value:function(e){var a=t("<div>",{class:"gantt-header"}),n=t("<div>",{class:"gantt-header-months"}),i=t("<div>",{class:"gantt-header-days"}),s=t("<div>",{class:"gantt-header-days-min"}),o=this.getTotalWidth(e);this.setHours();for(var r=new Date(this.config.startDate.getTime()),d=0;d<=e;d+=1){var l=r.getDay(),h=r.getDate(),c=r.getMonth()+1,g=r.getFullYear(),f=this.isTimeInRange(g,c,h),u=t("<div>",{class:"gantt-header-month"}).toggleClass("range",f),v=t("<div>",{class:"gantt-header-day"}).toggleClass("range",f),p=t("<div>",{class:"gantt-header-day-min"}).toggleClass("range",f),y=this.daysInMonth(c,g)*this.config.cellWidth,D=t(v).text(h).css("width",this.config.cellWidth);t(i).append(D);var m=this.config.lang.dayNamesMin[l],w=t(p).text(m).css({width:this.config.cellWidth});t(s).append(w);var L=0===d,T=this.firstDayMonth(g,c),H=this.firstDayMonth(this.config.endDate.getFullYear(),this.config.endDate.getMonth()+1);r.setHours(0,0,0,0);var W=this.isEqual(r,T),k=this.isEqual(r,H);if(W||L){L&&(y-=(h-1)*this.config.cellWidth),k&&(y=this.config.endDate.getDate()*this.config.cellWidth);var M=this.config.lang.monthNames[c-1],b=t(u).text(g+" "+M).css({width:y});t(n).append(b)}r.setDate(r.getDate()+1)}return a.append(t(n).css("width",o)),a.append(t(i).css("width",o)),a.append(t(s).css("width",o)),a}},{key:"renderContainer",value:function(){var e=t("<div>",{class:"gantt-container"}),a=t("<div>",{class:"gantt-wrapper"}),n=this.dateDiffInDays(this.config.startDate,this.config.endDate),i=this.renderHeader(n),s=this.renderGrid(n),o=this.renderEvents(n);return e.append(i).append(s).append(o),a.append('<div class="arrow arrow-left"><span class="arrow-icon"></span></div>').append(e).append('<div class="arrow arrow-right"><span class="arrow-icon"></span></div>'),a}},{key:"renderGrid",value:function(e){for(var a=this.config.data,n=this.getTotalWidth(e),i=this.getTotalHeight(a.length),s=t("<div>",{class:"gantt-grid",width:n}),o=t("<div>",{class:"gantt-grid-cols"}),r=t("<div>",{class:"gantt-grid-rows"}),d=new Date(this.config.startDate.getTime()),l=0;l<=e;l+=1){var h=t("<div>",{class:"gantt-grid-col",width:this.config.cellWidth,height:i});h.css("width",this.config.cellWidth);var c=d.getMonth()+1,g=d.getFullYear(),f=this.lastDayMonth(g,c);d.setHours(0,0,0,0),this.isEqual(d,f)&&h.css("border-color","#bec5cc"),o.append(h),d.setDate(d.getDate()+1)}return a.forEach(function(){var e=t("<div>",{class:"gantt-grid-row",width:n,height:this.config.cellHeight});r.append(e)},this),s.append(o).append(r),s}},{key:"renderEvents",value:function(e){var a=this,n=this.config.data,i=this.getTotalWidth(e),s=t("<div>",{class:"gantt-events",width:i});return n.forEach(function(e){var n=t("<div>",{class:"gantt-event-row",width:a.totalWidth});e.forEach(function(e){var i=new Date(e.startdate),s=t("<div>",{class:"gantt-event"}),o=(parseInt(e.minNight,10)+1)*a.config.cellWidth,r=a.dateDiffInDays(a.config.startDate,i),d=t.extend(e.tooltipData,{price:e.price}),l="";l="Tur"===e.type?"tourFly":"TurBus"===e.type?"tourBus":"cruise";var h=""+e.title,c=t("<a>",{class:"gantt-event-block "+l,width:o+"px",href:""+e.url,target:"_blank"}).text(h).css("line-height",a.config.cellHeight-28+"px").data("tooltip",a.tooltipView(d)),g=r*a.config.cellWidth;n.append(s.css("left",g).append(c)).css("height",a.config.cellHeight)},a),s.append(n)},this),s}},{key:"getTotalWidth",value:function(t){return 0===t?0:(t+1)*this.config.cellWidth}},{key:"getTotalHeight",value:function(t){return t*this.config.cellHeight}},{key:"setHours",value:function(){this.config.startDate.setHours(0,0,0,0),this.config.endDate.setHours(0,0,0,0)}},{key:"firstDayMonth",value:function(t,e){return new Date(t,e-1,1)}},{key:"lastDayMonth",value:function(t,e){return new Date(t,e,0)}},{key:"daysInMonth",value:function(t,e){return new Date(e,t,0).getDate()}},{key:"isEqual",value:function(t,e){return t.getTime()===e.getTime()}},{key:"dateDiffInDays",value:function(t,e){var a=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());return Math.floor((n-a)/864e5)}},{key:"getFormattedDate",value:function(t){var e=t.getDate(),a=t.getMonth()+1;return t.getFullYear()+"-"+a+"-"+e}},{key:"tooltipView",value:function(t){return this.format('<div class="gantt-tooltip">    <div class="tooltip-content">        <span class="title">{1}</span>        <div class="desc">            入组时间: {2} <br> 出组时间: {3} <br>        </div>    </div></div>',t.memberName,t.inGroupTime,t.outGroupTime)}},{key:"tooltipHover",value:function(){var e=t(this.element),a=this.config;t(".gantt-event-block",e).on("mouseenter",function(){var n=t(e).height(),i=t(e).offset().top,s=t(this).data("tooltip"),o=t(this).offset().left,r=t(this).offset().top;if(r>=n+i-168){s=t(s).css({left:o}),t("body").append(s);var d=t(".gantt-tooltip","body").outerHeight();t(".gantt-tooltip","body").css("top",r-d-12)}else s=t(s).css({top:r+a.cellHeight,left:o}),t("body").append(s);t(".gantt-tooltip","body").hide().fadeIn(250)}).on("mouseleave",function(){t(".gantt-tooltip","body").remove()})}},{key:"colHighlighter",value:function(){var e=t(this.element);t(".gantt-grid-col, .gantt-header-day, .gantt-header-day-min",e).on("mouseenter",function(){var a=t(this).index();t(".gantt-container",e).find(".gantt-grid-col").removeClass("active").eq(a).addClass("active"),t(".gantt-header",e).find(".gantt-header-days").find(".gantt-header-day").removeClass("active").eq(a).addClass("active"),t(".gantt-container",e).find(".gantt-header").find(".gantt-header-days-min").find(".gantt-header-day-min").removeClass("active").eq(a).addClass("active")}),t(".gantt-event-block",e).on("mousemove",function(){t(".gantt-container",e).find(".gantt-grid-col").removeClass("active"),t(".gantt-header",e).find(".gantt-header-days").find(".gantt-header-day").removeClass("active"),t(".gantt-container",e).find(".gantt-header").find(".gantt-header-days-min").find(".gantt-header-day-min").removeClass("active")})}},{key:"format",value:function(){for(var t=arguments[0],e=1;e<arguments.length;e+=1){var a=new RegExp("\\{"+(e-1)+"\\}","gm");t=t.replace(a,arguments[e])}return t}},{key:"destroy",value:function(){t(window).off("scroll"),this.element.empty(),this.element.removeData("plugin_Gantt"),this.hook("onDestroy")}}],[{key:"setDefaults",value:function(a){t.extend(e,a)}}]),a}();s.LANGUAGES={en:{monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"]}},t.extend(s.prototype,a);var o=t.fn.gantt;t.fn.gantt=function(e){return this.each(function(){t.data(this,"plugin_Gantt")||t.data(this,"plugin_Gantt",new s(t(this),e))})},t.fn.gantt.version="1.0.0",t.fn.gantt.l10n=s.LANGUAGES,t.fn.gantt.setDefaults=s.setDefaults,t.fn.gantt.noConflict=function(){return t.fn.gantt=o,this}});